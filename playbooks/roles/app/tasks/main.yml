---

- name: install apt packages
  apt: pkg={{ item }} state=present
  with_items:
    - git
    - libevent-dev
    - libzmq-dev
    - python-dev
    - python-gevent
    - python-virtualenv

- name: install pip packages
  pip: name={{ item }} state=present
  with_items:
    - circus
    - circus-web
    - chaussette
    - meinheld

- name: fetch application
  git: repo=http://gist.github.com/6049805.git
       dest=/var/www/hello

- name: create application config directory
  file: path=/etc/hello/ state=directory mode=0644

- name: deploy circus config
  copy: src=circus.ini dest=/etc/circus.ini

- name: deploy upstart config
  copy: src=circus.conf dest=/etc/init/circus.conf

- name: ensure app is running
  service: name=circus state=started

# BUG(https://github.com/ansible/ansible/issues/2189): always shows changed
- name: ensure app runs at startup
  service: name=circus enabled=true
